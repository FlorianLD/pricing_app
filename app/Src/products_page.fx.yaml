products_page As screen:
    Fill: =RGBA(247, 247, 247, 247)
    LoadingSpinnerColor: =App.Theme.Colors.Primary

    Rectangle6_2 As rectangle:
        BorderColor: =Color.LightGray
        BorderThickness: =0.5
        Fill: =Color.White
        Height: =32
        Visible: =false
        Width: =136
        X: =929
        Y: =205
        ZIndex: =1

    Rectangle6_1 As rectangle:
        BorderColor: =Color.LightGray
        BorderThickness: =0.5
        Fill: =Color.White
        Height: =32
        Visible: =false
        Width: =135
        X: =779
        Y: =205
        ZIndex: =2

    "product_catalog As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
        BorderColor: =App.Theme.Colors.Darker40
        DelayItemLoading: =true
        Fill: =Color.White
        Height: =402
        Items: |-
            =If(
                IsBlank(searchBar_product.Input),
            
                SortByColumns(
                    Filter(
                        product_data, 
                        status = "Current"
                    ), 
                    "Title", 
                    SortOrder.Ascending),
                    
                SortByColumns(
                    Filter(
                        product_data, 
                        status = "Current" && 
                        Or(
                            searchBar_product.Input in name, 
                            Text(id) = searchBar_product.Input
                        )
                    ), 
                    "Title", 
                    SortOrder.Ascending)
                
                //Partial and exact text match
                //SortByColumns(Filter(product_data, status = "Current" && productSearch.Value in name), "Title", SortOrder.Ascending)
            )
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        OnSelect: |-
            =Set(CurrentProductId, ThisItem.id);
            Set(CurrentProductPrice, ThisItem.price);
            Set(CurrentProductTitle, ThisItem.name);
        TemplatePadding: =0
        TemplateSize: =104
        Width: =403
        X: =83
        Y: =248
        ZIndex: =4

        Rectangle3_1 As rectangle:
            BorderColor: =App.Theme.Colors.Darker40
            Fill: =App.Theme.Colors.Darker30
            Height: =Parent.TemplateHeight - Separator3_1.Height
            OnSelect: =Select(Parent)
            Visible: =ThisItem.IsSelected
            Width: =4
            ZIndex: =1

        productImg As image:
            BorderColor: =App.Theme.Colors.Darker40
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            DisabledFill: =RGBA(244, 244, 244, 1)
            Height: =72
            OnSelect: =Select(Parent)
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Width: =72
            X: =16
            Y: =(Parent.TemplateHeight / 2) - (Self.Height / 2)
            ZIndex: =2

        productId As label:
            Color: =RGBA(0, 0, 0, 1)
            DisabledColor: =RGBA(166, 166, 166, 1)
            Font: =App.Theme.Font
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =Self.Size * 1.8
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =12
            Text: |-
                ="ID: "&ThisItem.id
            VerticalAlign: =VerticalAlign.Top
            Width: =productName.Width
            X: =103
            Y: =47
            ZIndex: =3

        productName As label:
            Color: =RGBA(50, 49, 48, 1)
            DisabledColor: =RGBA(166, 166, 166, 1)
            Font: =App.Theme.Font
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =Self.Size * 1.8
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: |-
                ="Product: "&ThisItem.name
            VerticalAlign: =VerticalAlign.Top
            Width: =Parent.TemplateWidth - 173
            X: =103
            Y: =16
            ZIndex: =4

        Separator3_1 As rectangle:
            BorderColor: =App.Theme.Colors.Darker40
            Fill: =RGBA(255, 255, 255, 1)
            Height: =8
            OnSelect: =Select(Parent)
            Width: =Parent.TemplateWidth
            Y: =Parent.TemplateHeight - Self.Height
            ZIndex: =5

        Alert_pendingRequestMsg As label:
            Color: =RGBA(247, 116, 38, 1)
            DisabledColor: =RGBA(166, 166, 166, 1)
            Font: =App.Theme.Font
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Normal, FontWeight.Normal)
            Height: =Self.Size * 1.8
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =8
            Text: |-
                =If(
                    IsEmpty(Filter(requests, product_id = ThisItem.id && status = "Pending")),
                    "",
                    "Request pending"
                )
            Tooltip: ="Created on the "&LookUp(requests, product_id = ThisItem.id && status = "Pending").request_date
            VerticalAlign: =VerticalAlign.Top
            Width: =100
            X: =125
            Y: =76
            ZIndex: =6

        Alert_pendingRequestIcon As Icon:
            DisplayMode: =DisplayMode.Edit
            Height: =26
            Icon: ="ErrorCircle"
            IconColor: =RGBA(247, 116, 38, 1)
            IconStyle: ='Icon.IconStyle'.Filled
            Tooltip: ="123"
            Visible: |-
                =If(
                    IsEmpty(Filter(requests, product_id = ThisItem.id && status = "Pending")),
                    false,
                    true
                )
            Width: =20
            X: =102
            Y: =68
            ZIndex: =7

        Btn_newRequest As Button:
            Appearance: ='ButtonCanvas.Appearance'.Transparent
            DisplayMode: |-
                =If(
                    IsEmpty(Filter(requests, product_id = ThisItem.id && status = "Pending")),
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Height: =35
            Icon: ="Add"
            IconStyle: ='ButtonCanvas.IconStyle'.Filled
            OnSelect: |-
                =Set(showElement, true);
                Set(CurrentProductId, ThisItem.id);
                Set(CurrentProductPrice, ThisItem.price);
                Set(CurrentProductTitle, ThisItem.name);
                Reset(InputNewPrice);
                Reset(requestComment);
                Reset(startDate);
                Reset(endDate);
            Text: =
            Visible: =true
            Width: =35
            X: =356
            Y: =33
            ZIndex: =8

    catalogTitle As label:
        BorderColor: =App.Theme.Colors.Darker40
        Color: =RGBA(0, 0, 0, 1)
        DisabledColor: =RGBA(166, 166, 166, 1)
        Font: =App.Theme.Font
        FontWeight: =FontWeight.Semibold
        Size: =20
        Text: ="Product catalog"
        Visible: =false
        Width: =255
        X: =83
        Y: =152
        ZIndex: =5

    Rectangle2 As rectangle:
        BorderColor: =App.Theme.Colors.Darker40
        DisplayMode: =DisplayMode.Disabled
        Fill: =Color.White
        Height: =431
        Width: =647
        X: =625
        Y: =248
        ZIndex: =7

    priceLineChart As lineChart:
        BorderColor: =Color.Red
        Color: =RGBA(53, 61, 63, 1)
        DisabledBorderColor: =RGBA(166, 166, 166, 1)
        Height: =374
        ItemColorSet: =
        Items: =Filter(product_data, id = CurrentProductId)
        Size: =11
        Width: =619
        X: =643
        XLabelAngle: =20
        Y: =304
        ZIndex: =8

    priceChartTitle As label:
        BorderColor: =Color.Red
        Color: =
        DisabledColor: =RGBA(166, 166, 166, 1)
        Font: =App.Theme.Font
        FontWeight: =FontWeight.Semibold
        Height: =44
        Size: =20
        Text: ="Price history"
        Visible: =false
        Width: =208
        X: =625
        Y: =152
        ZIndex: =9

    Rectangle6 As rectangle:
        BorderColor: =Color.LightGray
        BorderThickness: =0.5
        Fill: =Color.White
        Height: =32
        Visible: =false
        Width: =136
        X: =625
        Y: =206
        ZIndex: =10

    TextCanvas2 As Text:
        BorderColor: =RGBA(152, 208, 70, 1)
        BorderRadiusTopLeft: =
        BorderStyle: =BorderStyle.None
        BorderThickness: =1
        DisplayMode: =DisplayMode.Edit
        Height: =32
        Text: =searchBar_product.Input
        Visible: =false
        Width: =125
        X: =636
        Y: =206
        ZIndex: =11

    TextCanvas2_1 As Text:
        DisplayMode: =DisplayMode.Edit
        Height: =32
        Text: |-
            ="Min price: $"&Min(
                Filter(
                    product_data, 
                    id = CurrentProductId
                    ),
                price
            )
        Visible: =false
        Width: =136
        X: =789
        Y: =205
        ZIndex: =12

    TextCanvas2_2 As Text:
        DisplayMode: =DisplayMode.Edit
        Height: =32
        Text: |-
            ="Max price: $"&Max(
                Filter(
                    product_data, 
                    id = CurrentProductId
                    ),
                price
            )
        Visible: =false
        Width: =130
        X: =940
        Y: =205
        ZIndex: =13

    sectionSeparator As icon.VerticalLine:
        BorderColor: =App.Theme.Colors.Lighter10
        Color: =RGBA(0, 0, 0, 0)
        DisabledBorderColor: =RGBA(166, 166, 166, 1)
        DisabledColor: =RGBA(244, 244, 244, 1)
        Fill: =Color.LightGray
        FocusedBorderThickness: =0
        Height: =518
        Icon: =Icon.VerticalLine
        Width: =1
        X: =558
        Y: =161
        ZIndex: =14

    MsgNoProductFound As Text:
        Align: ='TextCanvas.Align'.Center
        DisplayMode: =DisplayMode.Edit
        Height: =98
        Size: =19
        Text: ="No product found"
        VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
        Visible: |-
            =If(
                product_catalog.AllItemsCount = 0,
                true,
                false
            )
        Width: =404
        X: =83
        Y: =349
        ZIndex: =15

    header As my_header:
        ZIndex: =16

    searchBar_product As searchBar:
        X: =83
        Y: =205
        ZIndex: =17

    sectionTitle_1 As sectionTitle:
        Text: ="Products"
        X: =83
        Y: =156
        ZIndex: =18

    sectionTitle_2 As sectionTitle:
        Text: ="Price history"
        X: =625
        Y: =156
        ZIndex: =19

    TextCanvas3 As Text:
        Align: ='TextCanvas.Align'.Center
        DisplayMode: =DisplayMode.Edit
        Height: =36
        Size: =20
        Text: =CurrentProductTitle
        Weight: ='TextCanvas.Weight'.Semibold
        Width: =248
        X: =828
        Y: =268
        ZIndex: =23

    refreshBtn_1 As Button:
        Appearance: ='ButtonCanvas.Appearance'.Transparent
        DisplayMode: =DisplayMode.Edit
        FontColor: =RGBA(106, 122, 127, 1)
        FontSize: =24
        Height: =31
        Icon: ="ArrowClockwise"
        OnSelect: =Refresh(product_data)
        Text: =
        Width: =28
        X: =451
        Y: =650
        ZIndex: =24

    darkBgForm As rectangle:
        BorderColor: =App.Theme.Colors.Darker40
        Fill: =RGBA(0, 0, 0, 50%)
        Height: =768
        Visible: =showElement
        Width: =1366
        ZIndex: =25

    countFooter_1 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =25

        Rectangle1_1 As rectangle:
            BorderColor: =App.Theme.Colors.Darker40
            Fill: =Color.White
            Height: =29
            Width: =403
            X: =83
            Y: =650
            ZIndex: =20

        TextCanvas1_1 As Text:
            Align: ='TextCanvas.Align'.Center
            DisplayMode: =DisplayMode.Edit
            FontColor: =RGBA(106, 122, 127, 1)
            Height: =29
            Size: =10
            Text: |-
                =If(
                    product_catalog.AllItemsCount <= 1,
                    product_catalog.AllItemsCount&" product",
                    product_catalog.AllItemsCount&" products"
                )
            Visible: =true
            Width: =403
            X: =83
            Y: =650
            ZIndex: =21

        sectionSeparator_3 As icon.VerticalLine:
            BorderColor: =App.Theme.Colors.Lighter10
            Color: =RGBA(0, 0, 0, 0)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            DisabledColor: =RGBA(244, 244, 244, 1)
            Fill: =Color.LightGray
            FocusedBorderThickness: =0
            Height: =0.5
            Icon: =Icon.HorizontalLine
            Width: =403
            X: =83
            Y: =650
            ZIndex: =22

    requestForm As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.Light
        Fill: =Color.White
        Height: =542
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Visible: =showElement
        Width: =377
        X: =494
        Y: =179
        ZIndex: =26

        Rectangle7 As rectangle:
            BorderColor: =
            Fill: =App.Theme.Colors.Darker40
            Height: =49
            Width: =377
            ZIndex: =1

        FormHeader As Text:
            Align: ='TextCanvas.Align'.Center
            DisplayMode: =DisplayMode.Edit
            FontColor: =RGBA(255, 255, 255, 1)
            Height: =35
            PaddingLeft: =0
            Size: =20
            Text: ="Price update request"
            Width: =235
            X: =70
            Y: =5
            ZIndex: =2

        TextCanvas5_7 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: ="New price"
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =88
            X: =FormAlignment
            Y: =194
            ZIndex: =4

        TextCanvas5_6 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: |-
                ="Current price: "
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =120
            X: =FormAlignment
            Y: =139
            ZIndex: =5

        TextCanvas5_4 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: |-
                ="ID:"
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =120
            X: =FormAlignment
            Y: =90
            ZIndex: =6

        TextCanvas5_5 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: |-
                ="Last update:"
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =120
            X: =FormAlignment
            Y: =114
            ZIndex: =7

        FormButtonSend As Button:
            AcceptsFocus: =true
            DisplayMode: |-
                =If(
                    And(
                        IsMatch(InputNewPrice.Value, "\d+(\.\d+)?"),
                        Int(InputNewPrice.Value) <> CurrentProductPrice
                    ),
                    DisplayMode.Edit,
                    DisplayMode.View
                )
                
                    
            Height: =32
            OnSelect: |-
                =Refresh(requests); // Refresh data source for the following check
                
                // Check if a request for the product already exist
                // If product already exists, abort request and send error message
                If(
                    IsEmpty(
                        Filter(
                            requests,
                            product_id = CurrentProductId &&
                            status = "Pending"
                        )
                    ) = true &&
                    IsMatch(InputNewPrice.Value, "\d+(\.\d+)?") &&
                    Int(InputNewPrice.Value) <> CurrentProductPrice,
                    Patch(
                        requests,
                        Defaults(requests),
                        {id: Last(requests).id + 1, product_id: CurrentProductId, old_price: CurrentProductPrice, new_price: Int(InputNewPrice.Value), request_date: Now(), status: "Pending", requester_comment: requestComment.comment, employee_id: CurrentUserId}
                    );
                    Notify("Request successfully created", NotificationType.Success, 4000);
                    Set(showElement, Blank()),
                
                    IsEmpty(
                        Filter(
                            requests,
                            product_id = CurrentProductId &&
                            status = "Pending"
                        )
                    ) = true &&
                    ! IsMatch(InputNewPrice.Value, "\d+(\.\d+)?"),
                    Notify("New price must be a number without text", NotificationType.Error, 4000)
                );
            Text: ="Send request"
            Width: =177
            X: =99
            Y: =471
            ZIndex: =8

        FormClose As Button:
            Appearance: ='ButtonCanvas.Appearance'.Transparent
            DisplayMode: =DisplayMode.Edit
            FontColor: =RGBA(255, 255, 255, 1)
            FontSize: =27
            Height: =21
            Icon: ="Dismiss"
            OnSelect: =Set(showElement, Blank())
            Text: =
            Width: =26
            X: =339
            Y: =15
            ZIndex: =9

        TextCanvas5_9 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: |-
                ="Product: "
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =120
            X: =FormAlignment
            Y: =66
            ZIndex: =13

        TextCanvas5_10 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: =CurrentProductTitle
            Width: =120
            X: =146
            Y: =65
            ZIndex: =14

        TextCanvas5_11 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: =CurrentProductId
            Width: =120
            X: =146
            Y: =90
            ZIndex: =15

        TextCanvas5_12 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: =DateValue(LookUp(product_data, id = CurrentProductId && status = "Current", start_date))
            Width: =120
            X: =146
            Y: =114
            ZIndex: =16

        TextCanvas5_13 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: ="$"&CurrentProductPrice
            Width: =120
            X: =146
            Y: =139
            ZIndex: =17

        "InputNewPrice As 'Text input'":
            BorderColor: |-
                =If(
                    And(
                        IsMatch(InputNewPrice.Value, "\d+(\.\d+)?"),
                        Int(InputNewPrice.Value) <> CurrentProductPrice
                    ),
                    Blank(),
                    Color.Red
                )
                
                    
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Placeholder: =
            TriggerOutput: ='TextInputCanvas.TriggerOutput'.Keypress
            Type: ="Text"
            Value: ="1"
            Width: =101
            X: =35
            Y: =226
            ZIndex: =18

        requestComment As formComment:
            X: =35
            Y: =364
            ZIndex: =19

        "startDate As 'Date picker'":
            BorderColor: |-
                =Switch(
                    true,
                    startDate.SelectedDate < Today(), Color.Red,
                    startDate.SelectedDate >= Today(), Color.White,
                    IsBlank(startDate.SelectedDate), Color.White
                )
            DisplayMode: =DisplayMode.Edit
            Format: ='DatePickerCanvas.Format'.Short
            Height: =32
            Placeholder: ="Select date"
            Width: =125
            X: =35
            Y: =305
            ZIndex: =20

        "endDate As 'Date picker'":
            BorderColor: |-
                =If(
                    endDate.SelectedDate > startDate.SelectedDate || IsBlank(endDate.SelectedDate),
                    Color.White,
                    Color.Red
                )
            DisplayMode: =DisplayMode.Edit
            Format: ='DatePickerCanvas.Format'.Short
            Height: =32
            Placeholder: ="Select date"
            Width: =125
            X: =168
            Y: =305
            ZIndex: =21

        TextCanvas5_8 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: ="Start date"
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =120
            X: =35
            Y: =273
            ZIndex: =22

        TextCanvas5_32 As Text:
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Text: ="End date"
            Weight: ='TextCanvas.Weight'.Semibold
            Width: =120
            X: =168
            Y: =273
            ZIndex: =23

